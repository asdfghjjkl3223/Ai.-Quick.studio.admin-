<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Quick Studio - Admin Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // Your Firebase Config
        const firebaseConfig = {
            apiKey: "AIzaSyAgpcpxQkz9pBPaVuTtPEXvAXIHbxtwX-g",
            authDomain: "ai-quick-studio.firebaseapp.com",
            projectId: "ai-quick-studio",
            storageBucket: "ai-quick-studio.firebasestorage.app",
            messagingSenderId: "43790372617",
            appId: "1:43790372617:web:cbe99f95562e04bba3cdd8"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // Admin Login
        window.loginAdmin = async () => {
            const btn = document.getElementById('login-btn');
            btn.innerHTML = "Verifying Admin...";
            try {
                await signInWithPopup(auth, provider);
            } catch (e) { 
                alert("Login Error: " + e.message); 
                btn.innerHTML = "Admin Secure Login";
            }
        };

        window.logoutAdmin = () => signOut(auth);

        // Global State
        let usersData = [];
        let pendingRequests = [];

        // App Navigation Logic
        window.switchTab = (tabId) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.nav-btn').forEach(el => el.classList.remove('text-indigo-400', 'bg-indigo-500/10'));
            
            document.getElementById(tabId).classList.remove('hidden');
            document.getElementById('nav-' + tabId).classList.add('text-indigo-400', 'bg-indigo-500/10');
        };

        // Real-time Database Listeners
        const startListeners = () => {
            // Listen to Users
            onSnapshot(collection(db, 'users'), (snapshot) => {
                usersData = [];
                snapshot.forEach(doc => usersData.push({ id: doc.id, ...doc.data() }));
                document.getElementById('total-users').innerText = usersData.length;
                renderUsers();
            });

            // Listen to UPI Requests
            onSnapshot(collection(db, 'upi_requests'), (snapshot) => {
                pendingRequests = [];
                snapshot.forEach(doc => {
                    if(doc.data().status === 'pending') pendingRequests.push({ id: doc.id, ...doc.data() });
                });
                document.getElementById('pending-upi').innerText = pendingRequests.length;
                renderUPI();
            });
        };

        // Render Users Table
        const renderUsers = () => {
            const list = document.getElementById('users-list');
            if(usersData.length === 0) {
                list.innerHTML = `<div class="p-6 text-center text-zinc-500">No users found.</div>`;
                return;
            }
            list.innerHTML = usersData.map(u => `
                <div class="p-4 border-b border-white/5 flex justify-between items-center bg-zinc-900/50 mb-2 rounded-2xl">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-indigo-500/20 rounded-full flex items-center justify-center text-indigo-400 font-bold border border-indigo-500/30">
                            ${u.name ? u.name.charAt(0) : 'U'}
                        </div>
                        <div>
                            <p class="font-bold text-sm">${u.name || 'Unknown'}</p>
                            <p class="text-xs text-zinc-500">${u.email}</p>
                        </div>
                    </div>
                    <div class="text-right">
                        <span class="bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded-md text-[10px] font-bold uppercase mb-1 inline-block">${u.plan || 'FREE'}</span>
                        <p class="font-mono text-sm text-emerald-400 font-bold">${u.credits || 0} Cr</p>
                    </div>
                </div>
            `).join('');
        };

        // Render UPI Requests
        const renderUPI = () => {
            const list = document.getElementById('upi-list');
            if(pendingRequests.length === 0) {
                list.innerHTML = `<div class="p-8 text-center text-zinc-500 border border-dashed border-white/10 rounded-3xl mt-4">No pending payments. You are all caught up!</div>`;
                return;
            }
            list.innerHTML = pendingRequests.map(r => `
                <div class="p-5 glass rounded-3xl mb-4 border border-indigo-500/20">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h4 class="font-black text-lg text-white">â‚¹${r.amount} Recharge</h4>
                            <p class="text-xs text-zinc-400">${r.userEmail}</p>
                        </div>
                        <span class="bg-amber-500/20 text-amber-500 px-2 py-1 rounded text-[10px] font-bold uppercase animate-pulse">Pending</span>
                    </div>
                    <div class="bg-black/50 p-3 rounded-xl border border-white/5 mb-4">
                        <p class="text-[10px] text-zinc-500 uppercase font-bold mb-1">Transaction ID</p>
                        <p class="font-mono text-sm text-indigo-400 select-all">${r.trxId}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="approvePayment('${r.id}', '${r.userEmail}', '${r.amount}')" class="flex-1 bg-emerald-500 text-black font-bold py-3 rounded-xl text-sm active:scale-95 transition-all flex justify-center items-center gap-2">
                            <i data-lucide="check-circle-2" class="w-4 h-4"></i> Approve
                        </button>
                        <button onclick="rejectPayment('${r.id}')" class="flex-1 bg-rose-500/10 text-rose-500 font-bold py-3 rounded-xl text-sm border border-rose-500/20 active:scale-95 transition-all">
                            Reject
                        </button>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        };

        // Actions
        window.approvePayment = async (docId, email, amount) => {
            if(!confirm("Approve payment and add credits?")) return;
            try {
                const creditsToAdd = amount === '149' ? 500 : (amount === '499' ? 2000 : 100);
                await updateDoc(doc(db, 'upi_requests', docId), { status: 'approved' });
                await updateDoc(doc(db, 'users', email), { 
                    credits: increment(creditsToAdd),
                    plan: creditsToAdd >= 2000 ? 'PRO' : 'VIP'
                });
                alert("Payment Approved! Credits Sent.");
            } catch(e) { alert("Error: " + e.message); }
        };

        window.rejectPayment = async (docId) => {
            if(!confirm("Reject this payment?")) return;
            await updateDoc(doc(db, 'upi_requests', docId), { status: 'rejected' });
        };

        // Auth Watcher
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('app-interface').classList.remove('hidden');
                document.getElementById('admin-name').innerText = user.displayName.split(' ')[0];
                startListeners();
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
                document.getElementById('app-interface').classList.add('hidden');
            }
        });
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #050505; overflow-x: hidden; }
        .indigo-blur { background: radial-gradient(circle at top right, rgba(99, 102, 241, 0.15) 0%, transparent 60%); }
        .glass { background: rgba(255, 255, 255, 0.02); backdrop-filter: blur(10px); }
    </style>
</head>
<body class="text-white">

    <div id="auth-screen" class="min-h-screen flex flex-col items-center justify-center p-8 text-center relative overflow-hidden">
        <div class="absolute inset-0 indigo-blur"></div>
        <div class="relative z-10 w-full max-w-sm">
            <div class="w-20 h-20 bg-indigo-600 rounded-3xl flex items-center justify-center mb-8 mx-auto shadow-[0_0_50px_rgba(79,70,229,0.4)]">
                <i data-lucide="shield-check" class="text-white w-10 h-10"></i>
            </div>
            <h1 class="text-3xl font-extrabold tracking-tight mb-2">ADMIN PRO</h1>
            <p class="text-zinc-500 mb-10 text-sm">Control Panel for AI Quick Studio</p>
            <button id="login-btn" onclick="loginAdmin()" class="w-full bg-white text-black font-extrabold py-4 px-6 rounded-2xl flex items-center justify-center gap-3 active:scale-95 transition-all">
                <img src="https://www.google.com/favicon.ico" class="w-5 h-5">
                Admin Secure Login
            </button>
        </div>
    </div>

    <div id="app-interface" class="hidden min-h-screen pb-24 relative">
        <div class="absolute inset-0 indigo-blur -z-10"></div>
        
        <header class="p-6 flex justify-between items-center sticky top-0 bg-[#050505]/80 backdrop-blur-md z-30 border-b border-white/5">
            <div>
                <p class="text-[10px] uppercase tracking-[0.2em] text-indigo-500 font-bold">Command Center</p>
                <h2 class="text-xl font-bold">Hello, <span id="admin-name" class="text-white">Boss</span></h2>
            </div>
            <button onclick="logoutAdmin()" class="bg-rose-500/10 text-rose-500 p-3 rounded-xl border border-rose-500/20">
                <i data-lucide="power" class="w-5 h-5"></i>
            </button>
        </header>

        <div class="p-6">
            <div id="tab-dashboard" class="tab-content space-y-6 animate-in fade-in duration-300">
                <div class="grid grid-cols-2 gap-4">
                    <div class="glass p-5 rounded-3xl border border-white/5 border-l-4 border-l-blue-500">
                        <i data-lucide="users" class="text-blue-500 mb-2 w-5 h-5"></i>
                        <p class="text-xs text-zinc-500 font-bold uppercase">Total Users</p>
                        <h3 id="total-users" class="text-3xl font-black mt-1">0</h3>
                    </div>
                    <div class="glass p-5 rounded-3xl border border-white/5 border-l-4 border-l-amber-500">
                        <i data-lucide="wallet" class="text-amber-500 mb-2 w-5 h-5"></i>
                        <p class="text-xs text-zinc-500 font-bold uppercase">Pending UPI</p>
                        <h3 id="pending-upi" class="text-3xl font-black mt-1">0</h3>
                    </div>
                </div>

                <div class="glass p-6 rounded-3xl border border-white/5 mt-6 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl"></div>
                    <h3 class="font-bold mb-1 flex items-center gap-2 text-indigo-400">
                        <i data-lucide="settings" class="w-4 h-4"></i> Global Engine Settings
                    </h3>
                    <p class="text-xs text-zinc-400 mb-4">Base configuration for all users.</p>
                    
                    <div class="bg-black/50 p-4 rounded-2xl border border-white/5">
                        <p class="text-[10px] text-zinc-500 uppercase font-bold tracking-widest mb-1">Active Face-Lock Prompt</p>
                        <p class="font-mono text-sm text-emerald-400">yah wala character</p>
                    </div>
                </div>
            </div>

            <div id="tab-users" class="tab-content hidden space-y-4 animate-in fade-in duration-300">
                <h3 class="font-black text-xl mb-4">User Registry</h3>
                <div id="users-list" class="space-y-2">
                    <div class="text-center text-zinc-500 animate-pulse">Loading users...</div>
                </div>
            </div>

            <div id="tab-upi" class="tab-content hidden animate-in fade-in duration-300">
                <h3 class="font-black text-xl mb-4 text-amber-500 flex items-center gap-2">
                    <i data-lucide="indian-rupee" class="w-6 h-6"></i> Action Required
                </h3>
                <div id="upi-list">
                    <div class="text-center text-zinc-500 animate-pulse">Scanning database...</div>
                </div>
            </div>
        </div>

        <nav class="fixed bottom-6 left-6 right-6 glass h-16 rounded-[2rem] flex items-center justify-around px-2 z-40 border border-white/10 shadow-2xl shadow-black">
            <button id="nav-tab-dashboard" onclick="switchTab('tab-dashboard')" class="nav-btn text-indigo-400 bg-indigo-500/10 p-3 rounded-2xl transition-all flex flex-col items-center">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
            </button>
            <button id="nav-tab-users" onclick="switchTab('tab-users')" class="nav-btn text-zinc-500 hover:text-white p-3 rounded-2xl transition-all flex flex-col items-center">
                <i data-lucide="users" class="w-5 h-5"></i>
            </button>
            <button id="nav-tab-upi" onclick="switchTab('tab-upi')" class="nav-btn text-zinc-500 hover:text-white p-3 rounded-2xl transition-all flex flex-col items-center relative">
                <i data-lucide="check-circle" class="w-5 h-5"></i>
            </button>
        </nav>
    </div>

    <script>lucide.createIcons();</script>
</body>
  </html>
